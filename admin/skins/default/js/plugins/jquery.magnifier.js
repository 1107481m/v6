(function(e){e.extend(e.fn,{magnify:function(t){return this.each(function(){var n={defaults:{lensWidth:160,lensHeight:160,link:true,delay:0},a:null,$img:null,$largeImage:null,$lens:null,$sensor:null,$loader:null,timeOut:null,largeWidth:0,largeHeight:0,init:function(t){n.options=e.extend({},n.defaults,t);n.a=this;n.$img=e("img",this);n.setLargeImage();n.setLens();n.setSensor();n.setLoader();n.loadImage();n.addHandles()},setLargeImage:function(){n.$largeImage=e(new Image);n.$largeImage.attr("src",n.a.href).css("display","none")},setLens:function(){n.$lens=e("<div id='dio-lens'></div>");n.$lens.css({width:n.options.lensWidth,height:n.options.lensHeight,visibility:"hidden",overflow:"hidden",position:"absolute",left:0,top:0}).appendTo("body")},setSensor:function(){n.$sensor=e("<div id='dio-sensor' style='position:absolute;'></div>");e("body").append(n.$sensor);if(n.options.link){n.$sensor.click(function(){e.fn.colorbox({href:n.a.href,open:true})})}},setLoader:function(){n.$loader=e("<div id='dio-loader'>loading</div>").css({width:n.options.lensWidth,height:n.options.lensHeight});n.$lens.append(n.$loader)},loadImage:function(){n.$largeImage.load(function(e){n.imgLoadCheck(n.$largeImage[0],n.loadCallback,n.errorCallback,e)})},imgLoadCheck:function(e,t,n){if(e!=null){function r(){if(e.complete){clearInterval(i);t()}}var i=setInterval(r,100)}else{n()}},loadCallback:function(){function e(){if(n.$largeImage.width()){n.largeWidth=n.$largeImage.width();n.largeHeight=n.$largeImage.height()}if(n.largeWidth){n.$loader.remove();clearInterval(t)}}n.$lens.append(n.$largeImage);var t=setInterval(e,100)},errorCallback:function(){alert("large image could not be loaded")},addHandles:function(){n.$sensor.css({width:n.$img.width()+"px",height:n.$img.height()+"px",top:n.$img.offset().top+"px",left:n.$img.offset().left+"px",backgroundColor:"#fff",opacity:"0"}).mousemove(function(e){n.handleMouseMove(e)}).mouseout(function(e){n.handleMouseOut(e)})},handleMouseMove:function(e){n.$lens.css({left:parseInt(e.pageX-n.options.lensWidth*.5)+"px",top:parseInt(e.pageY-n.options.lensHeight*.5)+"px"});if(n.options.delay){if(!n.timeOut){n.timeOut=setTimeout(function(){n.$lens.css("visibility","visible")},n.options.delay)}}else{n.$lens.css("visibility","visible")}if(n.largeWidth){n.positionLargeImage(e)}n.$lens.css("display","block")},positionLargeImage:function(e){var t={};t.x=n.largeWidth/n.$img.width();t.y=n.largeHeight/n.$img.height();var r=-t.x*Math.abs(e.pageX-n.$img.offset().left)+n.options.lensWidth/2+"px";var i=-t.y*Math.abs(e.pageY-n.$img.offset().top)+n.options.lensHeight/2+"px";n.$largeImage.css({position:"absolute",left:r,top:i,display:"block"})},handleMouseOut:function(e){if(n.timeOut){clearTimeout(n.timeOut);n.timeOut=null}n.$lens.css({visibility:"hidden",display:"none"})}};n.init.call(this,t)})}})})(jQuery)