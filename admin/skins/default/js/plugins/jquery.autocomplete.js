(function(e){function l(t){e("#info").append(v(t)+"<br>")}function c(e){var t=-1;var n=-1;if(typeof e.selectionStart!="undefined"){t=e.selectionStart;n=e.selectionEnd}else if(document.selection&&document.selection.createRange){var r=document.selection.createRange();var i;try{i=r.duplicate();i.moveToElementText(e)}catch(s){i=e.createTextRange()}i.setEndPoint("EndToStart",r);t=i.text.length;if(t>e.value.length)t=-1;i.setEndPoint("EndToStart",r);n=i.text.length;if(n>e.value.length)n=-1}return{start:t,end:n}}function h(e,t){e.focus();if(e.setSelectionRange){e.setSelectionRange(t,t)}else if(e.createTextRange){m=e.createTextRange();m.moveStart("character",t);m.collapse();m.select()}}function p(e){var t=[];for(var n=0;n<e.length;n++){if(e[n].id!=undefined&&e[n].value!=undefined){e[n].id=e[n].id+"";e[n].value=e[n].value+"";if(e[n].info!=undefined)e[n].info=e[n].info+"";t.push(e[n])}}return t}function d(e){if(e==undefined||!e)return"";return e.replace("\\","\\\\").replace("*","\\*").replace(".","\\.").replace("/","\\/")}function v(e){if(e==undefined||!e)return"";return e.replace("&","&").replace("<","&lt;").replace(">","&gt;")}function g(e){if(e==undefined||!e)return"";return e.replace(/^\s+/g,"")}var t=13;var n=9;var r=27;var i=37;var s=38;var o=39;var u=40;var a=8;var f=46;e.fn.autocomplete=function(n){return this.each(function(){function A(){var e=l.val();if(n.multi){var t=c(m);var r=t.start;for(;r>0&&e.charAt(r-1)!=",";r--){}var i=t.start;for(;i<e.length&&e.charAt(i)!=",";i++){}var e=e.substr(r,i-r)}return g(e)}function O(e){y=e;if(n.multi){var t=l.val();var r=c(m);var i=r.start;for(;i>0&&t.charAt(i-1)!=",";i--){}var s=r.start;for(;s<t.length&&t.charAt(s)!=",";s++){}var o=t.substr(0,i)+(i>0?" ":"")+e+t.substr(s);l.val(o);h(m,i+e.length+(i>0?1:0))}else{m.focus();l.val(e)}}function M(t){if(t.length<n.minchars){q();return false}if(n.cache&&t.length>b&&w.length){var r=[];for(var i=0;i<w.length;i++){var s=new RegExp("("+d(t)+")","ig");if(s.exec(w[i].value))r.push(w[i])}y=t;b=t.length;w=r;H(w);return false}else{clearTimeout(C);y=t;b=t.length;C=setTimeout(function(){w=[];if(e.isFunction(n.pre_callback))n.pre_callback();if(e.isFunction(n.get)){w=p(n.get(t));H(w)}else if(e.isFunction(n.ajax_get)){q();k=setTimeout(D,n.delay);n.ajax_get(t,_,a)}},n.delay)}return false}function _(e){P();w=p(e);H(w)}function D(){if(!T){T=e('<div class="jqac-menu"><div class="jqac-loading">Loading</div></div>').get(0);e(T).css("position","absolute");var t=l.offset();e(T).css("left",t.left+"px");e(T).css("top",t.top+l.height()+2+"px");if(!n.autowidth)e(T).width(l.width());e("body").append(T)}e(T).show();setTimeout(P,1e4)}function P(){if(T)e(T).hide();clearTimeout(k)}function H(t){if(S)e(S).remove();P();U();S=e('<div class="jqac-menu"></div>').get(0);e(S).css({position:"absolute","z-index":L,"max-height":n.height+"px","overflow-y":"auto"});x=e("<ul></ul>").get(0);e(x).css("list-style","none").css("margin","0px").css("padding","2px").css("overflow","hidden");var r=new RegExp("("+d(v(y))+")","ig");for(var i=0;i<t.length;i++){var s=new String(t[i].value);var o=v(s).replace(r,"<em>$1</em>");var u=e('<span class="jqac-link">'+o+"</span>").get(0);if(t[i].info!=undefined&&t[i].info!=""){e(u).append(e('<div class="jqac-info">'+t[i].info+"</div>"))}e(u).attr("name",i+1);e(u).click(function(){B()});e(u).mouseover(function(){F(e(this).attr("name"),true)});var a=e("<li></li>").get(0);e(a).append(u);e(x).append(a)}if(t.length==0){e(x).append('<li class="jqac-warning">'+n.noresults+"</li>")}e(S).append(x);var f=l.offset();e(S).css("left",f.left+"px");e(S).css("top",f.top+l.height()+2+"px");if(!n.autowidth)e(S).width(l.width());e(S).mouseover(function(){U()});e(S).mouseout(function(){z()});e("body").append(S);if(e.fn.bgiframe)e(S).bgiframe({height:S.scrollHeight});if(S.scrollHeight>n.height){e(S).height(n.height);e(S).width(e(S).width()+20)}E=0;N=setTimeout(function(){q()},n.timeout)}function B(){if(E&&w[E-1]){var t=w[E-1];if(t.affected_value!=undefined&&t.affected_value!="")O(t.affected_value);else O(t.value);if(e.isFunction(n.callback))n.callback(w[E-1],f,a);q()}}function j(t){if(!x||w.length==0)return false;var n;if(t==u)n=E+1;else if(t==s)n=E-1;if(n>e(x).children().size())n=1;if(n<1)n=e(x).children().size();F(n)}function F(t,n){if(!x)return false;if(E>0)I();E=Number(t);var r=e(x).children().get(E-1);r.className="jqac-highlight";if(!n)R(r);U()}function I(){if(!x)return false;if(E>0){e(x).children().get(E-1).className="";E=0}}function q(){U();if(S){e(S).remove();S=false;x=false;E=0}}function R(e){if(!S)return false;var t=S.clientHeight;var n=S.scrollHeight;var r=S.scrollTop;var i=e.offsetTop;var s=i+e.offsetHeight;if(s>r+t){S.scrollTop=s-t}else if(i<r){S.scrollTop=i}return true}function U(){clearTimeout(N)}function z(){clearTimeout(N);N=setTimeout(function(){q()},1e3)}var a=e(this).attr("rel").length>0?e(this).attr("rel"):false;var f=e(this).attr("id").length>0?e(this).attr("id"):false;var l=e(this);var m=e(this).get(0);if(!l.is("input:text,input:password,textarea"))return;if(!n&&(!e.isFunction(n.get)||!n.ajax_get)){return}if(l.attr("jqac")=="on")return;l.attr("jqac","on");l.attr("autocomplete","off");n=e.extend({delay:500,timeout:5e3,minchars:3,multi:false,cache:true,height:150,autowidth:false,noresults:"No results"},n);l.keydown(function(e){switch(e.which){case t:if(!S)return true;else B();return false;case r:q();return false}return true});l.keypress(function(e){switch(e.keyCode){case t:case r:return false;case s:j(e.keyCode);return false;case u:if(!S)M(A());else j(e.keyCode);return false}return true});l.keyup(function(e){switch(e.which){case t:case r:case i:case o:case s:case u:return false;default:M(A())}return true});var y="";var b=0;var w=[];var E=0;var S=false;var x=false;var T=false;var N=false;var C=false;var k=false;var L=l.css("z-index");})}})($)